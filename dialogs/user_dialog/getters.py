from aiogram.types import CallbackQuery, User, Message
from aiogram_dialog import DialogManager, ShowMode
from aiogram_dialog.api.entities import MediaAttachment
from aiogram_dialog.widgets.kbd import Button, Select
from aiogram_dialog.widgets.input import ManagedTextInput

from database.action_data_class import DataInteraction
from config_data.config import load_config, Config
from states.state_groups import startSG, PaymentSG


config: Config = load_config()


async def start_getter(event_from_user: User, dialog_manager: DialogManager, **kwargs):
    session: DataInteraction = dialog_manager.middleware_data.get('session')
    admin = False
    admins = [*config.bot.admin_ids]
    admins.extend([admin.user_id for admin in await session.get_admins()])
    if event_from_user.id in admins:
        admin = True
    text = ('<b>ü§ö–¢–µ–±—è –ø—Ä–∏–≤–µ—Ç—Å–≤—É–µ—Ç ¬´–¢–≤–æ–π –†–∞—Å—Å—ã–ª—å—â–∏–∫¬ª! </b>\n\nü§ñ –≠—Ç–æ—Ç –±–æ—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è '
            '—Ç–µ–ª–µ–≥—Ä–∞–º-—Ä–∞—Å—Å—ã–ª–∫–∞–º–∏. –° –µ–≥–æ –ø–æ–º–æ—â—å—é –≤—ã —Å–º–æ–∂–µ—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ –≤–∞—à–∏ '
            '–ª–∏—á–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã Telegram –ø—Ä—è–º–æ –≤ —Å–æ–±—Ä–∞–Ω–Ω—É—é –≤–∞–º–∏ –±–∞–∑—É, —ç–∫–æ–Ω–æ–º—è –ø—Ä–∏ —ç—Ç–æ–º –∫—É—á—É –≤—Ä–µ–º–µ–Ω–∏ –∏ —É—Å–∏–ª–∏–π.\n\n'
            '<b>üí° –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?</b>\n–ë–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞—Å—Å—ã–ª–æ–∫, –æ—Å–≤–æ–±–æ–∂–¥–∞—è –≤–∞—à–µ –≤—Ä–µ–º—è –¥–ª—è '
            '–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã—Ö –∑–∞–¥–∞—á. –ë–æ–ª—å—à–µ –Ω–∏–∫–∞–∫–æ–π —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã ‚Äî –≤—Å–µ –±—ã—Å—Ç—Ä–æ, —É–¥–æ–±–Ω–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.\n\n<em>üåü –ù–∞—á–Ω–∏—Ç–µ '
            '–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ¬´–í–∞—à–µ–≥–æ –†–∞—Å—Å—ã–ª—å—â–∏–∫–∞¬ª —É–∂–µ —Å–µ–≥–æ–¥–Ω—è –∏ –ø–æ—á—É–≤—Å—Ç–≤—É–π—Ç–µ, –∫–∞–∫ –≤–∞—à–∞ —Ä–∞–±–æ—Ç–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ—â–µ –∏ '
            '–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–µ–µ!</em>')
    return {
        'text': text,
        'admin': admin
    }


async def rate_choose(clb: CallbackQuery, widget: Button, dialog_manager: DialogManager):
    months = int(clb.data.split('_')[0])
    if months == 1:
        price = 1000
    elif months == 3:
        price = 2000
    else:
        price = 3000
    data = {
        'months': months,
        'amount': price
    }
    await dialog_manager.start(PaymentSG.payment_type, data=data)


async def about_getter(dialog_manager: DialogManager, **kwargs):
    text = ('ü§ñ <b>¬´–¢–≤–æ–π –†–∞—Å—Å—ã–ª—å—â–∏–∫¬ª</b> ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å—Å—ã–ª–æ–∫ –≤ Telegram. '
            '–ë–æ—Ç —Å–æ–∑–¥–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –≤—Ä–µ–º—è –∏ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π '
            '–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º.\n\n<b>üìå –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</b>\n1Ô∏è‚É£ –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Å–≤–æ–∏ –ª–∏—á–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã Telegram.'
            '2Ô∏è‚É£ –î–æ–±–∞–≤—å—Ç–µ –±–∞–∑—É –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ (–¥–æ 50 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π).\n3Ô∏è‚É£ –°–æ–∑–¥–∞–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏: '
            '—Ç–µ–∫—Å—Ç, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.\n4Ô∏è‚É£ –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ä–∞—Å—Å—ã–ª–∫—É ‚Äî –±–æ—Ç —Å–¥–µ–ª–∞–µ—Ç –≤—Å–µ –∑–∞ –≤–∞—Å.\n\nüéØ –ö–∞–∫—É—é –ø–æ–ª—å–∑—É –≤—ã –ø–æ–ª—É—á–∏—Ç–µ?\n'
            '–ë–æ—Ç –±–µ—Ä–µ—Ç –Ω–∞ —Å–µ–±—è –≤—Å—é —Ä—É—Ç–∏–Ω—É, —Å–≤—è–∑–∞–Ω–Ω—É—é —Å —Ä–∞—Å—Å—ã–ª–∫–∞–º–∏, –æ—Å–≤–æ–±–æ–∂–¥–∞—è –≤–∞—à–µ –≤—Ä–µ–º—è –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –±–æ–ª–µ–µ '
            '–≤–∞–∂–Ω—ã—Ö –∑–∞–¥–∞—á.\n\n<b>‚ùóÔ∏è –í–∞–∂–Ω–æ:</b>\n–†–∞—Å—Å—ã–ª–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –≤–∞—à–∏ –ª–∏—á–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã\n<b>üöÄ –ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å? '
            '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –±–æ—Ç–∞ —É–∂–µ —Å–µ–≥–æ–¥–Ω—è!</b>')
    return {'text': text}
